# ğŸ” MCP å·¥å…·çš„ stdio æœ¬åœ°é€šä¿¡æœºåˆ¶è¯¦è§£

## ğŸ“¡ stdio é€šä¿¡åŸç†

### 1. **ä»€ä¹ˆæ˜¯ stdio é€šä¿¡ï¼Ÿ**

stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰é€šä¿¡æ˜¯æŒ‡é€šè¿‡**è¿›ç¨‹é—´çš„æ ‡å‡†è¾“å…¥/è¾“å‡ºæµ**è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œè€Œä¸æ˜¯é€šè¿‡ç½‘ç»œHTTPè¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼š

```python
# åœ¨ local_command_adapter.py ä¸­çš„å®ç°
server_params = StdioServerParameters(
    command=self.command,      # å¦‚: "npx"
    args=self.args,           # å¦‚: ["-y", "tavily-mcp@0.2.1"]
    env=filtered_env          # ç¯å¢ƒå˜é‡
)

# å»ºç«‹stdioä¼ è¾“è¿æ¥
stdio_transport = await self.exit_stack.enter_async_context(
    stdio_client(server_params)
)
self.stdio, self.write = stdio_transport
```

**é€šä¿¡æµç¨‹ï¼š**
1. **å¯åŠ¨å­è¿›ç¨‹**ï¼šç³»ç»Ÿæ‰§è¡Œ `npx -y tavily-mcp@0.2.1` å‘½ä»¤
2. **å»ºç«‹ç®¡é“**ï¼šçˆ¶è¿›ç¨‹ï¼ˆæˆ‘ä»¬çš„Agentï¼‰ä¸å­è¿›ç¨‹é€šè¿‡ stdin/stdout ç®¡é“è¿æ¥
3. **JSON-RPCåè®®**ï¼šé€šè¿‡ç®¡é“å‘é€MCPåè®®çš„JSON-RPCæ¶ˆæ¯
4. **å®æ—¶é€šä¿¡**ï¼šå­è¿›ç¨‹å¤„ç†è¯·æ±‚å¹¶é€šè¿‡stdoutè¿”å›ç»“æœ

## ğŸ› ï¸ å·¥å…·çš„å®é™…ä½ç½®å’Œè·å–æ–¹å¼

### 2. **å·¥å…·æ¥æºåˆ†æ**

æ ¹æ® `tools.config.json` é…ç½®ï¼Œå·¥å…·æœ‰ä»¥ä¸‹å‡ ç§æ¥æºï¼š

#### A. **npm åŒ…ç®¡ç†å™¨å·¥å…·**ï¼ˆä¸»è¦æ–¹å¼ï¼‰
```json
"tavily_mcp": {
  "command": "npx",
  "args": ["-y", "tavily-mcp@0.2.1"],
  "env": {"TAVILY_API_KEY": "${TAVILY_API_KEY}"},
  "disabled": false
}
```

**å·¥å…·ä½ç½®ï¼š**
- **è¿œç¨‹ä»“åº“**ï¼šhttps://www.npmjs.com/package/tavily-mcp
- **æœ¬åœ°ç¼“å­˜**ï¼š`~/.npm/_npx/` æˆ–ä¸´æ—¶ç›®å½•
- **æ‰§è¡Œæ–¹å¼**ï¼š`npx -y` è‡ªåŠ¨ä¸‹è½½å¹¶æ‰§è¡Œï¼Œæ— éœ€é¢„å®‰è£…

#### B. **æœ¬åœ°Pythonè„šæœ¬**
```json
"weather_server": {
  "command": "python",
  "args": ["path/to/weather_server.py"],
  "env": {"WEATHER_API_KEY": "${WEATHER_API_KEY}"},
  "disabled": true
}
```

**å·¥å…·ä½ç½®ï¼š**
- **æœ¬åœ°æ–‡ä»¶**ï¼šé¡¹ç›®ç›®å½•ä¸‹çš„å…·ä½“Pythonæ–‡ä»¶
- **æ‰§è¡Œæ–¹å¼**ï¼šç›´æ¥è¿è¡Œæœ¬åœ°è„šæœ¬

#### C. **Node.js æœ¬åœ°è„šæœ¬**
```json
"file_manager": {
  "command": "node",
  "args": ["path/to/file_manager.js"],
  "disabled": true
}
```

### 3. **å·¥å…·è°ƒç”¨çš„å®Œæ•´æµç¨‹**

```
ç”¨æˆ·æŸ¥è¯¢ â†’ Agentå†³ç­– â†’ é€‰æ‹©å·¥å…· â†’ å¯åŠ¨MCPæœåŠ¡å™¨è¿›ç¨‹ â†’ stdioé€šä¿¡ â†’ è·å–ç»“æœ
```

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **å·¥å…·å‘ç°**ï¼š
   ```python
   # tool_manager.py è§£æé…ç½®
   packages = self._parse_packages()  # ä» tools.config.json è¯»å–
   ```

2. **è¿›ç¨‹å¯åŠ¨**ï¼š
   ```bash
   # ç³»ç»Ÿå®é™…æ‰§è¡Œçš„å‘½ä»¤
   npx -y tavily-mcp@0.2.1
   # æˆ–
   python path/to/weather_server.py
   ```

3. **å»ºç«‹è¿æ¥**ï¼š
   ```python
   # åˆ›å»ºstdioç®¡é“
   stdio_transport = await stdio_client(server_params)
   self.stdio, self.write = stdio_transport
   ```

4. **å·¥å…·è°ƒç”¨**ï¼š
   ```python
   # é€šè¿‡stdioå‘é€JSON-RPCè¯·æ±‚
   result = await self.adapter_session.call_tool(tool_name, filtered_kwargs)
   ```

## ğŸ”„ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨HTTPï¼Ÿ

### 4. **stdio vs HTTP å¯¹æ¯”**

| ç‰¹æ€§ | stdio æœ¬åœ°é€šä¿¡ | HTTP ç½‘ç»œé€šä¿¡ |
|------|---------------|---------------|
| **å»¶è¿Ÿ** | ~1ms (è¿›ç¨‹é—´) | ~50-200ms (ç½‘ç»œ) |
| **å¸¦å®½** | æ— é™åˆ¶ (å†…å­˜) | å—ç½‘ç»œé™åˆ¶ |
| **å®‰å…¨æ€§** | è¿›ç¨‹éš”ç¦» | éœ€è¦è®¤è¯/åŠ å¯† |
| **éƒ¨ç½²** | æ— éœ€æœåŠ¡å™¨ | éœ€è¦HTTPæœåŠ¡å™¨ |
| **èµ„æº** | æŒ‰éœ€å¯åŠ¨ | å¸¸é©»å†…å­˜ |
| **è°ƒè¯•** | è¿›ç¨‹æ—¥å¿— | ç½‘ç»œæŠ“åŒ… |

### 5. **å®é™…çš„å·¥å…·æ‰§è¡Œç¤ºä¾‹**

å½“æ‚¨é—®"ä»æ­å·åˆ°è¥¿å®‰æ€ä¹ˆèµ°"æ—¶ï¼š

```bash
# ç³»ç»Ÿå®é™…æ‰§è¡Œï¼š
$ npx -y @baidumap/mcp-server-baidu-map

# è¿›ç¨‹å¯åŠ¨åï¼Œé€šè¿‡stdinå‘é€JSON-RPCè¯·æ±‚ï¼š
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "map_directions",
    "arguments": {
      "origin": "æ­å·",
      "destination": "è¥¿å®‰"
    }
  },
  "id": 1
}

# å·¥å…·é€šè¿‡stdoutè¿”å›ç»“æœï¼š
{
  "jsonrpc": "2.0",
  "result": {
    "content": [
      {
        "type": "text",
        "text": "ä»æ­å·åˆ°è¥¿å®‰çš„è·¯çº¿è§„åˆ’ï¼š..."
      }
    ]
  },
  "id": 1
}
```

## ğŸ¯ æŠ€æœ¯ä¼˜åŠ¿æ€»ç»“

### 6. **ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§æ–¹å¼ï¼Ÿ**

1. **æ€§èƒ½ä¼˜åŠ¿**ï¼š
   - æ— ç½‘ç»œå¼€é”€ï¼Œå»¶è¿Ÿæä½
   - ç›´æ¥å†…å­˜é€šä¿¡ï¼Œå¸¦å®½æ— é™åˆ¶

2. **éƒ¨ç½²ç®€å•**ï¼š
   - æ— éœ€ç»´æŠ¤HTTPæœåŠ¡å™¨
   - å·¥å…·æŒ‰éœ€å¯åŠ¨ï¼Œèµ„æºé«˜æ•ˆ

3. **ç”Ÿæ€ä¸°å¯Œ**ï¼š
   - ç›´æ¥ä½¿ç”¨npmç”Ÿæ€çš„MCPå·¥å…·
   - æ”¯æŒä»»ä½•èƒ½æä¾›stdioæ¥å£çš„è¯­è¨€

4. **å®‰å…¨å¯é **ï¼š
   - è¿›ç¨‹çº§åˆ«éš”ç¦»
   - æ— ç½‘ç»œæ”»å‡»é¢

5. **å¼€å‘å‹å¥½**ï¼š
   - é…ç½®ç®€å•ï¼ˆåªéœ€commandå’Œargsï¼‰
   - è‡ªåŠ¨ä¾èµ–ç®¡ç†ï¼ˆnpxè‡ªåŠ¨ä¸‹è½½ï¼‰
   - ç»Ÿä¸€çš„MCPåè®®æ¥å£

## ğŸ“ å·¥å…·çš„å®é™…å­˜å‚¨ä½ç½®

- **npmå·¥å…·**ï¼š`~/.npm/_npx/` ä¸´æ—¶ç¼“å­˜ç›®å½•
- **æœ¬åœ°è„šæœ¬**ï¼šé¡¹ç›®æŒ‡å®šçš„ç›¸å¯¹/ç»å¯¹è·¯å¾„
- **PythonåŒ…**ï¼šè™šæ‹Ÿç¯å¢ƒæˆ–ç³»ç»ŸPythonè·¯å¾„
- **Node.jsåŒ…**ï¼šnode_modulesæˆ–å…¨å±€å®‰è£…ç›®å½•

è¿™ç§è®¾è®¡è®©æˆ‘ä»¬çš„Agentèƒ½å¤Ÿ**æ— ç¼é›†æˆ**å„ç§å·¥å…·ï¼Œè€Œæ— éœ€å…³å¿ƒå…·ä½“çš„ç½‘ç»œé…ç½®ã€æœåŠ¡å™¨éƒ¨ç½²ç­‰å¤æ‚é—®é¢˜ï¼ğŸš€
        