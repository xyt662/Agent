# SynapseAgent æŠ€æœ¯æ¶æ„æ·±åº¦è§£æ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**SynapseAgent** æ˜¯ä¸€ä¸ªåŸºäº LangGraph æ„å»ºçš„é«˜çº§æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ä»£ç†ç³»ç»Ÿï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œé›†æˆäº† MCPï¼ˆModel Context Protocolï¼‰å·¥å…·ç”Ÿæ€ï¼Œå®ç°äº†æ™ºèƒ½åŒ–çš„å¤šæ¨¡æ€ä»»åŠ¡å¤„ç†èƒ½åŠ›

### æ ¸å¿ƒç‰¹æ€§
- ğŸ—ï¸ **æ¨¡å—åŒ–æ¶æ„**ï¼šåŸºäºä¾èµ–æ³¨å…¥å’Œå…³æ³¨ç‚¹åˆ†ç¦»çš„è®¾è®¡åŸåˆ™
- ğŸ”„ **ReActå·¥ä½œæµ**ï¼šå®ç° Reason-Act å¾ªç¯çš„æ™ºèƒ½å†³ç­–æœºåˆ¶
- ğŸ› ï¸ **MCPå·¥å…·é›†æˆ**ï¼šæ”¯æŒæœ¬åœ°MCPæœåŠ¡å™¨çš„åŠ¨æ€å·¥å…·è°ƒç”¨
- ğŸ“š **RAGæ£€ç´¢ç³»ç»Ÿ**ï¼šå¤šå±‚æ¬¡çš„æ–‡æ¡£æ£€ç´¢å’Œé‡æ’åºæœºåˆ¶
- âš¡ **å¼‚æ­¥ä¼˜å…ˆ**ï¼šå…¨å¼‚æ­¥çš„å·¥å…·è°ƒç”¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

---

## ğŸ›ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### æ¶æ„å±‚æ¬¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI Server  â”‚  CLI Interface  â”‚  Test Runners         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å·¥å‚å±‚ (Factory Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent Factory   â”‚  Dependency Injection  â”‚  Caching       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å›¾å±‚ (Graph Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LangGraph       â”‚  State Management     â”‚  Flow Control   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    èŠ‚ç‚¹å±‚ (Node Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent Node      â”‚  Tool Node           â”‚  Routing Logic   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å·¥å…·å±‚ (Tool Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MCP Tools        â”‚  MCP Adapter       â”‚  Tool Registry  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ ¸å¿ƒå±‚ (Core Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LLM Provider    â”‚  Config Management    â”‚  State Definitionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### 1. ä¾èµ–æ³¨å…¥ (Dependency Injection)
- **å·¥å‚æ¨¡å¼**ï¼šé€šè¿‡ `AgentFactory` ç»Ÿä¸€ç®¡ç†ç»„ä»¶çš„åˆ›å»ºå’Œè£…é…
- **æ¥å£æŠ½è±¡**ï¼šå„ç»„ä»¶é€šè¿‡æ¥å£è§£è€¦ï¼Œä¾¿äºæµ‹è¯•å’Œæ›¿æ¢
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€æ³¨å…¥ä¾èµ–å…³ç³»

#### 2. å…³æ³¨ç‚¹åˆ†ç¦» (Separation of Concerns)
- **å›¾å®šä¹‰ä¸å®ç°åˆ†ç¦»**ï¼š`graphs/` ç›®å½•åªå®šä¹‰ç»“æ„ï¼Œä¸åŒ…å«å…·ä½“å®ç°
- **ä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½åˆ†ç¦»**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å·¥å…·ã€é…ç½®ç­‰åŸºç¡€è®¾æ–½è§£è€¦
- **çŠ¶æ€ç®¡ç†ç»Ÿä¸€åŒ–**ï¼šé€šè¿‡ `AgentState` ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çŠ¶æ€ä¿¡æ¯

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

#### AgentState è®¾è®¡
```python
class AgentState(TypedDict):
    """ç°ä»£åŒ–çš„AgentçŠ¶æ€,åªé€šè¿‡messagesé©±åŠ¨ä¸€åˆ‡"""
    messages: Annotated[List[BaseMessage], operator.add]
```

**è®¾è®¡äº®ç‚¹**ï¼š
- **ç®€åŒ–çŠ¶æ€ç»“æ„**ï¼šéµå¾ªç°ä»£ LangGraph æœ€ä½³å®è·µï¼Œåªä¿ç•™ `messages` å­—æ®µ
- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ `TypedDict` ç¡®ä¿ç±»å‹å®‰å…¨
- **è‡ªåŠ¨èšåˆ**ï¼šé€šè¿‡ `operator.add` å®ç°æ¶ˆæ¯çš„è‡ªåŠ¨è¿½åŠ 

### 2. å·¥å‚æ¨¡å¼å®ç°

#### Agent Factory æ¶æ„
```python
async def get_main_agent_runnable() -> Callable:
    """å·¥å‚å‡½æ•°,è´Ÿè´£ç»„è£…å’Œç¼–è¯‘ä¸»Agent"""
    # 1. è·å–å·¥å…·ç­¾åç”¨äºç¼“å­˜key
    # 2. æ£€æŸ¥ç¼“å­˜æ˜¯å¦å‘½ä¸­
    # 3. å¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æ„å»ºæ–°çš„Agentå®ä¾‹
    # 4. è¿”å›Agentå®ä¾‹
```

**æ ¸å¿ƒèŒè´£**ï¼š
- **é›¶ä»¶è·å–**ï¼šè°ƒç”¨ `llm_provider` è·å–LLMï¼Œè°ƒç”¨ `tool_registry` è·å–å·¥å…·
- **è“å›¾é€‰æ‹©**ï¼šä» `graphs` ç›®å½•å¯¼å…¥å›¾æ¨¡æ¿
- **ç»„è£…ç¼–è¯‘**ï¼šå°†å…·ä½“ç»„ä»¶æ³¨å…¥å›¾æ¨¡æ¿å¹¶ç¼–è¯‘
- **ç¼“å­˜ç®¡ç†**ï¼šé€šè¿‡ LRU ç¼“å­˜æé«˜æ€§èƒ½

### 3. LangGraph å·¥ä½œæµå¼•æ“

#### ReAct å·¥ä½œæµè®¾è®¡
```python
def should_continue(state: AgentState) -> str:
    """è·¯ç”±é€»è¾‘ï¼šæ£€æŸ¥æœ€æ–°çš„æ¶ˆæ¯æ˜¯å¦åŒ…å«å·¥å…·è°ƒç”¨"""
    if state['messages'][-1].tool_calls:
        return "action"
    return "end"
```

**å·¥ä½œæµç¨‹**ï¼š
1. **Agent Node**ï¼šLLM åˆ†æè¾“å…¥ï¼Œå†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
2. **Conditional Edge**ï¼šåŸºäº LLM è¾“å‡ºå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
3. **Tool Node**ï¼šæ‰§è¡Œå…·ä½“çš„å·¥å…·è°ƒç”¨
4. **å¾ªç¯æ‰§è¡Œ**ï¼šç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°

### 4. MCP å·¥å…·é›†æˆç³»ç»Ÿ

#### æœ¬åœ°å‘½ä»¤é€‚é…å™¨
```python
class LocalCommandToolAdapter:
    """æœ¬åœ°å‘½ä»¤MCPé€‚é…å™¨ç±»
    
    è´Ÿè´£å¯åŠ¨æœ¬åœ°MCPæœåŠ¡å™¨å­è¿›ç¨‹å¹¶ä¸å…¶é€šä¿¡
    å°†MCPå·¥å…·è½¬æ¢ä¸ºLangChainå·¥å…·
    """
```

**æŠ€æœ¯å®ç°**ï¼š
- **Stdio é€šä¿¡**ï¼šé€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºä¸ MCP æœåŠ¡å™¨é€šä¿¡
- **å¼‚æ­¥ç®¡ç†**ï¼šä½¿ç”¨ `AsyncExitStack` ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
- **åŠ¨æ€å·¥å…·ç”Ÿæˆ**ï¼šè¿è¡Œæ—¶åŠ¨æ€åˆ›å»º LangChain å·¥å…·åŒ…è£…å™¨
- **ç¯å¢ƒå˜é‡æ³¨å…¥**ï¼šè‡ªåŠ¨è§£æå’Œæ³¨å…¥ API å¯†é’¥

#### å·¥å…·åŒ…ç®¡ç†å™¨
```python
class ToolPackageManager:
    """å·¥å…·åŒ…ç®¡ç†å™¨"""
    
    def __init__(self, project_root: Optional[Path] = None):
        # é…ç½®åŠ è½½å’Œå·¥å…·åŒ…è§£æ
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **é…ç½®è§£æ**ï¼šæ”¯æŒå®˜æ–¹ `mcpServers` æ ¼å¼å’Œè‡ªå®šä¹‰æ ¼å¼
- **ç¯å¢ƒå˜é‡è§£æ**ï¼šåŠ¨æ€è§£æ `${VAR_NAME}` æ ¼å¼çš„ç¯å¢ƒå˜é‡
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç† MCP æœåŠ¡å™¨å­è¿›ç¨‹
- **çƒ­é‡è½½æ”¯æŒ**ï¼šæ”¯æŒé…ç½®æ–‡ä»¶çš„çƒ­é‡è½½

### 5. RAG æ£€ç´¢ç³»ç»Ÿ

#### æ£€ç´¢ç®¡é“æ¶æ„
```python
class RetrievalPipeline:
    """æ£€ç´¢ç®¡é“
    
    èŒè´£ï¼š
    - ç¼–æ’å®Œæ•´çš„æ£€ç´¢æµç¨‹
    - ç®¡ç†å„ä¸ªæ£€ç´¢ç»„ä»¶
    - æä¾›å¯é…ç½®çš„æ£€ç´¢ç­–ç•¥
    - å¤„ç†å¼‚å¸¸å’Œå›é€€æœºåˆ¶
    """
```

**æ£€ç´¢æµç¨‹**ï¼š
1. **æŸ¥è¯¢è½¬æ¢**ï¼šé€šè¿‡ `QueryTransformer` ä¼˜åŒ–æŸ¥è¯¢
2. **å‘é‡æ£€ç´¢**ï¼šä½¿ç”¨ `VectorDBRetriever` è¿›è¡Œç›¸ä¼¼åº¦æœç´¢
3. **æ–‡æ¡£å»é‡**ï¼šç§»é™¤é‡å¤çš„æ£€ç´¢ç»“æœ
4. **é‡æ’åº**ï¼šé€šè¿‡ `DocumentReranker` ä¼˜åŒ–ç»“æœæ’åº
5. **ç¼“å­˜æœºåˆ¶**ï¼šé¿å…é‡å¤æ£€ç´¢æé«˜æ€§èƒ½

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆåˆ†æ

### æ ¸å¿ƒæ¡†æ¶

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬è¦æ±‚ | ä½œç”¨ |
|------|----------|----------|------|
| **LangChain** | langchain-core | >=0.1.0 | åŸºç¡€æ¡†æ¶å’Œå·¥å…·æŠ½è±¡ |
| **LangGraph** | langgraph | >=0.1.0 | å·¥ä½œæµç¼–æ’å’ŒçŠ¶æ€ç®¡ç† |
| **MCP** | mcp | >=1.0.0 | å·¥å…·åè®®å’Œå®¢æˆ·ç«¯ |
| **FastAPI** | fastapi | >=0.104.0 | Web API æœåŠ¡ |
| **ChromaDB** | chromadb | >=0.4.0 | å‘é‡æ•°æ®åº“ |

### è¯­è¨€æ¨¡å‹æ”¯æŒ

| æä¾›å•† | é›†æˆæ–¹å¼ | é…ç½®æ–¹å¼ |
|--------|----------|----------|
| **DeepSeek** | langchain-deepseek | ç¯å¢ƒå˜é‡ `DEEPSEEK_API_KEY` |
| **Qwen** | langchain_community | ç¯å¢ƒå˜é‡ `DASHSCOPE_API_KEY` |

### å·¥å…·ç”Ÿæ€

| å·¥å…·ç±»å‹ | å®ç°æ–¹å¼ | é…ç½®æ–‡ä»¶ |
|----------|----------|----------|
| **ç™¾åº¦åœ°å›¾** | MCP Server (npm) | tools.config.json |
| **Tavilyæœç´¢** | MCP Server (npm) | tools.config.json |
| **çŸ¥è¯†åº“æ£€ç´¢** | å†…ç½®å·¥å…· | ä»£ç é…ç½® |

---

## âš™ï¸ é…ç½®ç®¡ç†ç³»ç»Ÿ

### é…ç½®æ–‡ä»¶å±‚æ¬¡

```
é…ç½®ç®¡ç†
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡å’ŒAPIå¯†é’¥
â”œâ”€â”€ tools.config.json       # MCPå·¥å…·é…ç½®
â””â”€â”€ ä»£ç é…ç½®               # ç¡¬ç¼–ç çš„é»˜è®¤é…ç½®
```

### MCP å·¥å…·é…ç½®ç¤ºä¾‹
```json
{
  "mcpServers": {
    "tavily_mcp": {
      "command": "npx",
      "args": ["-y", "tavily-mcp@0.2.1"],
      "env": {
        "TAVILY_API_KEY": "${TAVILY_API_KEY}"
      },
      "disabled": false
    }
  }
}
```

**é…ç½®ç‰¹æ€§**ï¼š
- **ç¯å¢ƒå˜é‡æ’å€¼**ï¼šæ”¯æŒ `${VAR_NAME}` æ ¼å¼çš„å˜é‡æ›¿æ¢
- **çƒ­é‡è½½**ï¼šæ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°
- **å‘åå…¼å®¹**ï¼šåŒæ—¶æ”¯æŒå®˜æ–¹æ ¼å¼å’Œè‡ªå®šä¹‰æ ¼å¼

---

## ğŸ”„ å·¥ä½œæµç¨‹è¯¦è§£

### 1. Agent åˆå§‹åŒ–æµç¨‹

```mermaid
sequenceDiagram
    participant U as User
    participant F as AgentFactory
    participant TM as ToolManager
    participant G as GraphBuilder
    participant L as LLMProvider
    
    U->>F: get_main_agent_runnable()
    F->>TM: åˆå§‹åŒ–å·¥å…·ç®¡ç†å™¨
    TM->>TM: åŠ è½½é…ç½®æ–‡ä»¶
    TM->>TM: å¯åŠ¨MCPæœåŠ¡å™¨
    F->>L: è·å–LLMå®ä¾‹
    F->>G: åˆ›å»ºå›¾æ„å»ºå™¨
    G->>G: å®šä¹‰èŠ‚ç‚¹å’Œè¾¹
    F->>F: ç¼–è¯‘æœ€ç»ˆåº”ç”¨
    F->>U: è¿”å›å¯è¿è¡Œåº”ç”¨
```

### 2. æŸ¥è¯¢å¤„ç†æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·è¾“å…¥] --> B[Agent Node]
    B --> C{éœ€è¦å·¥å…·è°ƒç”¨?}
    C -->|æ˜¯| D[Tool Node]
    C -->|å¦| E[ç›´æ¥å›ç­”]
    D --> F[æ‰§è¡Œå·¥å…·]
    F --> G[å·¥å…·ç»“æœ]
    G --> B
    E --> H[è¿”å›ç»“æœ]
```

### 3. MCP å·¥å…·è°ƒç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant A as Agent
    participant TN as ToolNode
    participant MCP as MCPAdapter
    participant S as MCPServer
    
    A->>TN: è°ƒç”¨å·¥å…·
    TN->>MCP: è½¬å‘è°ƒç”¨
    MCP->>S: stdioé€šä¿¡
    S->>S: æ‰§è¡Œå·¥å…·é€»è¾‘
    S->>MCP: è¿”å›ç»“æœ
    MCP->>TN: åŒ…è£…ç»“æœ
    TN->>A: è¿”å›å·¥å…·æ¶ˆæ¯
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜æœºåˆ¶

#### Agent å®ä¾‹ç¼“å­˜
```python
_agent_cache = {}

def _get_cache_key(tools_signature: str, llm_model: str) -> str:
    return f"{tools_signature}_{llm_model}"
```

#### æ£€ç´¢ç»“æœç¼“å­˜
```python
class RetrievalPipeline:
    def __init__(self):
        self._cache: Dict[str, List[Document]] = {}
        self._enable_cache = self.config.get('enable_cache', False)
```

### 2. å¼‚æ­¥ä¼˜åŒ–

- **å…¨å¼‚æ­¥æ¶æ„**ï¼šæ‰€æœ‰ I/O æ“ä½œéƒ½ä½¿ç”¨å¼‚æ­¥å®ç°
- **å¹¶å‘å·¥å…·è°ƒç”¨**ï¼šæ”¯æŒå¤šä¸ªå·¥å…·çš„å¹¶å‘æ‰§è¡Œ
- **èµ„æºæ± ç®¡ç†**ï¼šå¤ç”¨ MCP è¿æ¥å’Œ LLM å®ä¾‹

### 3. å†…å­˜ç®¡ç†

- **çŠ¶æ€ç®€åŒ–**ï¼šåªä¿ç•™å¿…è¦çš„ `messages` çŠ¶æ€
- **å·¥å…·ç¼“å­˜**ï¼šé¿å…é‡å¤åŠ è½½å·¥å…·å®šä¹‰
- **è¿æ¥å¤ç”¨**ï¼šå¤ç”¨ MCP æœåŠ¡å™¨è¿æ¥

---

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•å±‚æ¬¡ç»“æ„

```
tests/
â”œâ”€â”€ unit/                   # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ test_tool_manager.py
â”œâ”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_tool_manager_integration.py
â”œâ”€â”€ test_api_client.py      # APIå®¢æˆ·ç«¯æµ‹è¯•
â”œâ”€â”€ test_baidu_api_key.py   # ç™¾åº¦APIå¯†é’¥æµ‹è¯•
â”œâ”€â”€ test_baidu_map_tools.py # ç™¾åº¦åœ°å›¾å·¥å…·æµ‹è¯•
â”œâ”€â”€ test_both_endpoints.py  # åŒç«¯ç‚¹æµ‹è¯•
â”œâ”€â”€ test_mcp_direct.py      # MCPç›´æ¥è°ƒç”¨æµ‹è¯•
â””â”€â”€ test_mcp_tools_simple.py # MCPå·¥å…·ç®€å•æµ‹è¯•
```

### æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•å•ä¸ªç»„ä»¶çš„åŠŸèƒ½
- **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•ç»„ä»¶é—´çš„åä½œ
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæµ‹è¯•å®Œæ•´çš„ç”¨æˆ·åœºæ™¯
- **å·¥å…·æµ‹è¯•**ï¼šéªŒè¯ MCP å·¥å…·çš„å¯ç”¨æ€§

---


## ğŸ”® æŠ€æœ¯æ¼”è¿›è·¯çº¿

### å·²å®ç°åŠŸèƒ½
- âœ… åŸºç¡€ ReAct å·¥ä½œæµ
- âœ… MCP å·¥å…·é›†æˆ
- âœ… RAG æ£€ç´¢ç³»ç»Ÿ
- âœ… å·¥å‚æ¨¡å¼æ¶æ„
- âœ… å¼‚æ­¥ä¼˜åŒ–

### è§„åˆ’ä¸­åŠŸèƒ½
- ğŸ”„ å¤šè·³æŸ¥è¯¢åˆ†è§£
- ğŸ”„ è‡ªæˆ‘çº é”™æœºåˆ¶
- ğŸ”„ ä¸»åŠ¨æ¾„æ¸…åŠŸèƒ½
- ğŸ”„ é”™è¯¯å¤„ç†èŠ‚ç‚¹
- ğŸ”„ æ›´å¤šå·¥å…·é›†æˆ

### æŠ€æœ¯å€ºåŠ¡
- ğŸ“ å®Œå–„æ–‡æ¡£è¦†ç›–
- ğŸ§ª å¢åŠ æµ‹è¯•è¦†ç›–ç‡
- ğŸ”§ æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡
- ğŸ›¡ï¸ å®‰å…¨æ€§åŠ å›º

